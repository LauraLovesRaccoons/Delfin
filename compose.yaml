#version: "3.1"
name: "${APP_NAME}"
services:
  mysql:
    image: "${MYSQL_IMAGE}"
    container_name: "${COMPOSE_PROJECT_NAME}${MYSQL_CONTAINER_EXTENSION}"
    restart: "${MYSQL_RESTART}"
    environment:
      MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
      MYSQL_DATABASE: "${MYSQL_DATABASE}"
      MYSQL_USER: "${MYSQL_USER}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD}"
    # ports:                # same docker container, so
    #   - "${MYSQL_PORTS}"  # no need to expose the port(s)
    networks:
      - delfin_network
  phpmyadmin:
    image: "${PMA_IMAGE}"
    container_name: "${COMPOSE_PROJECT_NAME}${PMA_CONTAINER_EXTENSION}"
    restart: "${PMA_RESTART}"   # 
    profiles:
      - "pma"   #  docker compose --profile pma up ;; to enable the service
    environment:
      PMA_HOST: "${MYSQL_SERVICE_NAME}"        # must be named after the service
      PMA_USER: "${PMA_USER}"
      # PMA_PASSWORD: "${PMA_PASSWORD}"       # 
      PMA_PASSWORD: "${MYSQL_ROOT_PASSWORD}"  # 
    ports:
      - "${PMA_PORTS}"
    networks:
      - delfin_network
  php-apache:
    image: "${PHP_IMAGE}"
    container_name: "${COMPOSE_PROJECT_NAME}${PHP_CONTAINER_EXTENSION}"
    restart: "${PHP_RESTART}"
    environment:
      - max_upload=10M            # 
    env_file:
      - .env                      #Â those are used in functions.php
    volumes:
      - ./php/src:/var/www/html/  # Path to folder in windows : Path to folder in Linux
    ports:
      - "${PHP_PORTS}"            # 
      # - 8000-8010:8000-8010
    networks:
      - delfin_network
    build:
      context: ./php
      dockerfile: dockerfile    # extensions install

  #wordpress:
    #image: wordpress:latest
    #restart: always
    #ports:
      #- 80:80
    #environment:
      #WORDPRESS_DB_HOST: db
      #WORDPRESS_DB_USER: root
      #WORDPRESS_DB_PASSWORD: root
      #WORDPRESS_DB_NAME: wordpress
    #volumes:
      #- wordpress:/var/www/html

volumes:
  mysql:
  phpmyadmin:
  php-apache-environment:
  #wordpress:

networks:
  delfin_network:
    driver: bridge

